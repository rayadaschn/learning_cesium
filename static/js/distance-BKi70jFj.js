import{b as e,d as t,h as i,_ as n,u as o,r as a,o as s,c as r,a as l,w as u,g as c,t as p,f as C}from"./index-c6kv0ykA.js";function m(n){const o=e(null),a=e(n);t((()=>{n instanceof Cesium.Viewer&&(o.value=new Cesium.CustomDataSource("measureLayer"),a.value.dataSources.add(o.value))})),i((()=>{o.value&&n&&a.value.dataSources.remove(o.value)}));const s=e=>e.map((e=>(e=>{const t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(e);return{longitude:Cesium.Math.toDegrees(t.longitude),latitude:Cesium.Math.toDegrees(t.latitude),altitude:t.height}})(e))),r=e=>{const{longitude:t,latitude:i,altitude:n}=e;return Cesium.Cartographic.fromDegrees(t,i,n)},l=(e,t=1)=>{const i=a.value.scene.pickPosition(e),n=Cesium.Cartographic.fromCartesian(i);n.height+=t;return Cesium.Cartesian3.fromRadians(n.longitude,n.latitude,n.height)};return{transformWGS84ToCartesian:e=>{const{longitude:t,latitude:i,altitude:n}=e;return Cesium.Cartesian3.fromDegrees(t,i,n,Cesium.Ellipsoid.WGS84)},drawLineMeasureGraphics:(e={})=>{var t;const{callback:i,width:n,material:u}=e,c=[];let p;const C=new Cesium.ScreenSpaceEventHandler(a.value.scene.canvas),m=e=>{var t;const i=(e=>{if(e.length<2)return"0.000";let t=0;const i=new Cesium.EllipsoidGeodesic;for(let n=0;n<e.length-1;n++){const o=r(e[n]),a=r(e[n+1]);i.setEndPoints(o,a);let s=i.surfaceDistance;s=Math.sqrt(Math.pow(s,2)+Math.pow(a.height-o.height,2)),t+=s}return t.toFixed(3)})(s(c)),n=(Number(i)/1e3).toFixed(3),a=Number(n)>1?`${n} 公里`:`${i} 米`,l=new Cesium.Entity({position:e,point:{pixelSize:8,outlineColor:Cesium.Color.BLUE,outlineWidth:8},label:{text:a,show:!0,showBackground:!0,backgroundColor:new Cesium.Color(0,0,0,.5),font:"14px monospace",horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(-20,-20)}});null==(t=o.value)||t.entities.add(l)};C.setInputAction((e=>{const t=l(e.position);t&&t.x&&(0===c.length&&c.push(t.clone()),m(t),c.push(t))}),Cesium.ScreenSpaceEventType.LEFT_CLICK),C.setInputAction((e=>{const t=l(e.endPosition);c.length>=2&&t&&t.x&&(c.pop(),c.push(t))}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),C.setInputAction((e=>{C.destroy();const t=l(e.position);m(t),"function"==typeof i&&i(s(c),p)}),Cesium.ScreenSpaceEventType.RIGHT_CLICK);const d=new Cesium.Entity({polyline:{width:n??10,material:u||new Cesium.PolylineArrowMaterialProperty(Cesium.Color.BLUE),positions:new Cesium.CallbackProperty((()=>c),!1)}});p=null==(t=o.value)?void 0:t.entities.add(d)},drawAreaMeasureGraphics:(e={})=>{var t;const{callback:i,width:n,material:r}=e,u=[];let c;const p=new Cesium.ScreenSpaceEventHandler(a.value.scene.canvas),C=(e,t=!0)=>{var i;const n=(e=>{if(!e||e.length<3)return 0;const t=Cesium.Ellipsoid.WGS84;let i=0;const n=e.map((e=>{const i=Cesium.Cartographic.fromDegrees(e.longitude,e.latitude),n=t.cartographicToCartesian(i);return{x:n.x,y:n.y}}));for(let o=0;o<n.length;o++){const e=(o+1)%n.length;i+=n[o].x*n[e].y-n[e].x*n[o].y}return Math.abs(i)/2})(s(u)),a=(n/1e6).toFixed(3),r=n>1e6?`${a} 平方公里`:`${n.toFixed(3)} 平方米`,l=new Cesium.Entity({position:e,point:{pixelSize:8,outlineColor:Cesium.Color.BLUE,outlineWidth:8},label:{text:r,show:t,showBackground:!0,backgroundColor:new Cesium.Color(0,0,0,.5),font:"14px monospace",horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(-20,-20)}});null==(i=o.value)||i.entities.add(l)};p.setInputAction((e=>{const t=l(e.position);t&&t.x&&(0===u.length&&u.push(t.clone()),C(t,!1),u.push(t))}),Cesium.ScreenSpaceEventType.LEFT_CLICK),p.setInputAction((e=>{const t=l(e.endPosition);u.length>=2&&t&&t.x&&(u.pop(),u.push(t))}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),p.setInputAction((e=>{p.destroy();const t=l(e.position);C(t),u.push(u[0]),"function"==typeof i&&i(s(u),c)}),Cesium.ScreenSpaceEventType.RIGHT_CLICK);const m=new Cesium.Entity({polyline:{width:n??10,material:r||new Cesium.PolylineArrowMaterialProperty(Cesium.Color.BLUE),positions:new Cesium.CallbackProperty((()=>u),!1)},polygon:{hierarchy:new Cesium.CallbackProperty((()=>({positions:u})),!1),material:Cesium.Color.WHITE.withAlpha(.3),perPositionHeight:!0}});c=null==(t=o.value)?void 0:t.entities.add(m)}}}const d={class:"container"},h=n({__name:"distance",setup(t){const i=o().viewer;i.camera.setView({destination:Cesium.Cartesian3.fromDegrees(120.153576,30.287459,3e3)});const{drawLineMeasureGraphics:n,drawAreaMeasureGraphics:h}=m(i),g=e(!1),v=()=>{g.value=!0;n({callback:(e,t)=>{console.log("绘制完成",e,t),g.value=!1}})},w=e(!1),y=()=>{w.value=!0;h({callback:(e,t)=>{console.log("绘制完成",e,t),w.value=!1}})};return(e,t)=>{const i=a("el-button");return s(),r("div",d,[l(i,{type:"primary",onClick:v},{default:u((()=>[c(p(C(g)?"开始绘制":"距离测量"),1)])),_:1}),l(i,{type:"primary",onClick:y},{default:u((()=>[c(p(C(w)?"开始绘制":"空间面积"),1)])),_:1})])}}},[["__scopeId","data-v-be219601"]]);export{h as default};
